<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Badge App Store - Git Tree Stats</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #2a2a2a 100%);
            color: #e0e0e0;
            padding: 40px 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(20, 20, 20, 0.95);
            border-radius: 12px;
            padding: 50px 60px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            border: 3px solid #CC0000;
        }

        @media (min-width: 2560px) {
            .container {
                max-width: 2400px;
                padding: 60px 80px;
            }
        }

        h1 {
            text-align: center;
            color: #CC0000;
            font-size: 3em;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(204, 0, 0, 0.6),
                0 0 10px rgba(204, 0, 0, 0.4);
            font-weight: bold;
        }

        .subtitle {
            text-align: center;
            color: #cccccc;
            margin-bottom: 50px;
            font-size: 1.3em;
        }

        @media (min-width: 2560px) {
            h1 {
                font-size: 3.5em;
            }

            .subtitle {
                font-size: 1.5em;
            }
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #CC0000;
        }

        .spinner {
            border: 4px solid rgba(80, 80, 80, 0.3);
            border-left-color: #CC0000;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        .spinner-small {
            border: 3px solid rgba(80, 80, 80, 0.3);
            border-left-color: #CC0000;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .tree {
            font-size: 16px;
            line-height: 2;
            margin-top: 40px;
            margin-bottom: 40px;
        }

        .tree-root {
            color: #CC0000;
            font-weight: bold;
            margin-bottom: 20px;
            font-size: 1.4em;
            text-shadow: 0 0 10px rgba(204, 0, 0, 0.5);
        }

        .tree-item {
            padding: 15px 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        @media (min-width: 2560px) {
            .tree {
                font-size: 18px;
            }

            .tree-root {
                font-size: 1.6em;
            }
        }

        .tree-item:hover {
            background: rgba(204, 0, 0, 0.15);
            padding-left: 10px;
            border-left: 3px solid #CC0000;
        }

        .tree-content {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            flex: 1;
        }

        .contributors-list {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
        }

        .contributor {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(40, 40, 40, 0.8);
            padding: 4px 10px 4px 4px;
            border-radius: 20px;
            font-size: 0.85em;
            transition: all 0.2s ease;
            border: 1px solid rgba(204, 0, 0, 0.4);
        }

        .contributor:hover {
            background: rgba(204, 0, 0, 0.3);
            transform: scale(1.05);
            border-color: #CC0000;
        }

        .contributor-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid #CC0000;
        }

        .contributor-name {
            color: #cccccc;
            font-weight: 500;
        }

        .tree-branch {
            color: #808080;
            margin-right: 8px;
        }

        .app-name {
            color: #ffffff;
            font-weight: bold;
        }

        .stat-box {
            display: inline-block;
            margin-left: 10px;
            padding: 4px 12px;
            border-radius: 5px;
            font-size: 0.95em;
            border: 1px solid;
        }

        @media (min-width: 2560px) {
            .stat-box {
                padding: 5px 14px;
                font-size: 1em;
            }
        }

        .stat-stars {
            background: rgba(204, 0, 0, 0.2);
            color: #ff3333;
            border-color: rgba(204, 0, 0, 0.5);
        }

        .stat-code {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border-color: rgba(255, 255, 255, 0.3);
        }

        .stat-contributors {
            background: rgba(150, 150, 150, 0.2);
            color: #cccccc;
            border-color: rgba(150, 150, 150, 0.4);
        }

        .stat-commits {
            background: rgba(200, 200, 200, 0.15);
            color: #e0e0e0;
            border-color: rgba(200, 200, 200, 0.3);
        }

        .stat-date {
            background: rgba(180, 180, 180, 0.15);
            color: #d0d0d0;
            border-color: rgba(180, 180, 180, 0.3);
        }

        .leaderboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 50px;
        }

        .leaderboard-card {
            background: rgba(30, 30, 30, 0.8);
            border-radius: 10px;
            padding: 25px;
            border: 2px solid rgba(204, 0, 0, 0.4);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .leaderboard-title {
            color: #CC0000;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(204, 0, 0, 0.5);
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            margin: 8px 0;
            background: rgba(20, 20, 20, 0.7);
            border-radius: 6px;
            border-left: 4px solid #CC0000;
            font-size: 1.05em;
        }

        @media (min-width: 2560px) {
            .leaderboard {
                grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
                gap: 30px;
            }

            .leaderboard-card {
                padding: 30px;
            }

            .leaderboard-title {
                font-size: 1.7em;
            }

            .leaderboard-item {
                padding: 12px 18px;
                font-size: 1.1em;
            }
        }

        .leaderboard-item:nth-child(2) {
            border-left-color: #ff3333;
            background: rgba(204, 0, 0, 0.15);
        }

        .leaderboard-item:nth-child(3) {
            border-left-color: #aa0000;
        }

        .leaderboard-item:nth-child(4) {
            border-left-color: #880000;
        }

        .rank {
            color: #808080;
            font-weight: bold;
            margin-right: 10px;
        }

        .item-name {
            flex: 1;
            color: #cccccc;
        }

        .item-value {
            color: #ffffff;
            font-weight: bold;
        }

        .error {
            background: rgba(204, 0, 0, 0.2);
            border: 1px solid #CC0000;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            color: #ff3333;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-icon {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }

        .top-sections-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 50px;
        }

        @media (max-width: 1400px) {
            .top-sections-container {
                grid-template-columns: 1fr;
            }
        }

        @media (min-width: 2560px) {
            .top-sections-container {
                gap: 40px;
                margin-bottom: 60px;
            }
        }

        .race-section {
            background: rgba(30, 30, 30, 0.8);
            border-radius: 12px;
            padding: 30px;
            border: 2px solid rgba(204, 0, 0, 0.4);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .race-title {
            color: #CC0000;
            font-size: 2.5em;
            margin-bottom: 35px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(204, 0, 0, 0.6);
        }

        .race-track {
            margin: 30px 0;
        }

        .race-row {
            display: flex;
            align-items: center;
            margin: 18px 0;
            gap: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .race-row:hover {
            transform: translateX(5px);
        }

        .racer-info {
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 250px;
        }

        .racer-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 3px solid #CC0000;
        }

        .racer-name {
            color: #ffffff;
            font-weight: bold;
            font-size: 1.1em;
        }

        .race-bar-container {
            flex: 1;
            background: rgba(20, 20, 20, 0.9);
            border-radius: 30px;
            height: 48px;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(80, 80, 80, 0.7);
        }

        @media (min-width: 2560px) {
            .race-title {
                font-size: 3em;
            }

            .racer-info {
                min-width: 300px;
            }

            .racer-avatar {
                width: 56px;
                height: 56px;
            }

            .racer-name {
                font-size: 1.2em;
            }

            .race-bar-container {
                height: 56px;
            }
        }

        .race-bar {
            height: 100%;
            background: linear-gradient(90deg, #888888, #aaaaaa);
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 20px;
            transition: width 2s ease-out;
            position: relative;
            overflow: hidden;
        }

        @media (min-width: 2560px) {
            .race-bar {
                padding-right: 25px;
            }
        }

        .race-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            to {
                left: 200%;
            }
        }

        .race-bar.first {
            background: linear-gradient(90deg, #CC0000, #ff3333);
        }

        .race-bar.second {
            background: linear-gradient(90deg, #aa0000, #dd0000);
        }

        .race-bar.third {
            background: linear-gradient(90deg, #880000, #bb0000);
        }

        .race-value {
            color: #ffffff;
            font-weight: bold;
            font-size: 1em;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
            z-index: 1;
        }

        .race-position {
            font-size: 1.8em;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
        }

        @media (min-width: 2560px) {
            .race-value {
                font-size: 1.1em;
            }

            .race-position {
                font-size: 2em;
                min-width: 60px;
            }
        }

        .race-position.first {
            color: #ff3333;
        }

        .race-position.second {
            color: #dd0000;
        }

        .race-position.third {
            color: #bb0000;
        }

        .race-position.other {
            color: #808080;
        }

        .race-tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .race-tab {
            padding: 12px 30px;
            background: rgba(30, 30, 30, 0.8);
            border: 2px solid rgba(204, 0, 0, 0.4);
            border-radius: 8px;
            cursor: pointer;
            color: #cccccc;
            font-weight: bold;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        @media (min-width: 2560px) {
            .race-tab {
                padding: 14px 35px;
                font-size: 1.2em;
            }
        }

        .race-tab:hover {
            background: rgba(204, 0, 0, 0.2);
            border-color: #CC0000;
        }

        .race-tab.active {
            background: #CC0000;
            color: #ffffff;
            border-color: #CC0000;
            box-shadow: 0 0 15px rgba(204, 0, 0, 0.6);
        }

        .special-prize-section {
            background: linear-gradient(135deg, rgba(204, 0, 0, 0.2) 0%, rgba(30, 30, 30, 0.9) 100%);
            border-radius: 12px;
            padding: 30px;
            border: 3px solid #CC0000;
            box-shadow: 0 0 30px rgba(204, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .special-prize-title {
            color: #ff3333;
            font-size: 2em;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0 0 25px rgba(204, 0, 0, 0.8);
        }

        .special-prize-subtitle {
            color: #cccccc;
            font-size: 1em;
            margin-bottom: 25px;
            text-align: center;
            font-style: italic;
        }

        @media (min-width: 2560px) {
            .special-prize-section {
                padding: 40px;
            }

            .special-prize-title {
                font-size: 2.4em;
            }

            .special-prize-subtitle {
                font-size: 1.2em;
            }
        }

        .special-prize-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (min-width: 2560px) {
            .special-prize-grid {
                gap: 25px;
            }
        }

        .special-prize-card {
            background: rgba(20, 20, 20, 0.9);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid rgba(204, 0, 0, 0.6);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }

        @media (min-width: 2560px) {
            .special-prize-card {
                padding: 25px;
            }
        }

        .special-prize-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(204, 0, 0, 0.4);
            border-color: #ff3333;
        }

        .special-prize-card-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(204, 0, 0, 0.3);
        }

        .special-prize-icon {
            font-size: 2.5em;
        }

        @media (min-width: 2560px) {
            .special-prize-icon {
                font-size: 3em;
            }
        }

        .special-prize-card-title {
            color: #ffffff;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        @media (min-width: 2560px) {
            .special-prize-card-title {
                font-size: 1.4em;
            }
        }

        .special-prize-link {
            color: #ff3333;
            font-size: 0.9em;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        @media (min-width: 2560px) {
            .special-prize-link {
                font-size: 1em;
            }
        }

        .special-prize-link:hover {
            color: #ffffff;
            text-shadow: 0 0 10px rgba(204, 0, 0, 0.8);
        }

        .special-prize-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .special-prize-stat {
            background: rgba(40, 40, 40, 0.8);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(204, 0, 0, 0.3);
        }

        @media (min-width: 2560px) {
            .special-prize-stat {
                padding: 18px;
            }
        }

        .special-prize-stat-label {
            color: #808080;
            font-size: 0.75em;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        @media (min-width: 2560px) {
            .special-prize-stat-label {
                font-size: 0.85em;
            }
        }

        .special-prize-stat-value {
            color: #ff3333;
            font-size: 1.5em;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(204, 0, 0, 0.5);
        }

        @media (min-width: 2560px) {
            .special-prize-stat-value {
                font-size: 1.8em;
            }
        }

        .special-prize-contributors {
            background: rgba(20, 20, 20, 0.7);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid rgba(204, 0, 0, 0.4);
        }

        @media (min-width: 2560px) {
            .special-prize-contributors {
                padding: 25px;
            }
        }

        .special-prize-contributors-title {
            color: #ff3333;
            font-size: 1.4em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 15px rgba(204, 0, 0, 0.5);
        }

        @media (min-width: 2560px) {
            .special-prize-contributors-title {
                font-size: 1.6em;
            }
        }

        .all-contributors-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        @media (min-width: 2560px) {
            .all-contributors-grid {
                gap: 15px;
            }
        }

        .special-contributor-card {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(40, 40, 40, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid rgba(204, 0, 0, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        @media (min-width: 2560px) {
            .special-contributor-card {
                padding: 18px;
            }
        }

        .special-contributor-card:hover {
            background: rgba(204, 0, 0, 0.3);
            border-color: #CC0000;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(204, 0, 0, 0.4);
        }

        .special-contributor-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid #CC0000;
        }

        @media (min-width: 2560px) {
            .special-contributor-avatar {
                width: 60px;
                height: 60px;
            }
        }

        .special-contributor-info {
            flex: 1;
            min-width: 0;
        }

        .special-contributor-name {
            color: #ffffff;
            font-weight: bold;
            font-size: 1em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        @media (min-width: 2560px) {
            .special-contributor-name {
                font-size: 1.1em;
            }
        }

        .special-contributor-prs {
            color: #ff3333;
            font-size: 0.85em;
        }

        @media (min-width: 2560px) {
            .special-contributor-prs {
                font-size: 0.95em;
            }
        }

        .resources-section {
            margin-top: 50px;
            background: rgba(30, 30, 30, 0.8);
            border-radius: 12px;
            padding: 40px;
            border: 2px solid rgba(204, 0, 0, 0.4);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .resources-title {
            color: #CC0000;
            font-size: 2.5em;
            margin-bottom: 35px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(204, 0, 0, 0.6);
        }

        @media (min-width: 2560px) {
            .resources-section {
                padding: 50px;
                margin-top: 60px;
            }

            .resources-title {
                font-size: 3em;
            }
        }

        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 30px;
        }

        @media (min-width: 2560px) {
            .resources-grid {
                gap: 40px;
            }
        }

        .resources-card {
            background: rgba(20, 20, 20, 0.7);
            border-radius: 10px;
            padding: 30px;
            border: 2px solid rgba(204, 0, 0, 0.3);
        }

        @media (min-width: 2560px) {
            .resources-card {
                padding: 35px;
            }
        }

        .resources-card-title {
            color: #ff3333;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 10px rgba(204, 0, 0, 0.4);
        }

        @media (min-width: 2560px) {
            .resources-card-title {
                font-size: 1.7em;
            }
        }

        .resource-links {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .resource-link {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(40, 40, 40, 0.8);
            padding: 20px;
            border-radius: 8px;
            border: 2px solid rgba(204, 0, 0, 0.4);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        @media (min-width: 2560px) {
            .resource-link {
                padding: 25px;
            }
        }

        .resource-link:hover {
            background: rgba(204, 0, 0, 0.3);
            border-color: #CC0000;
            transform: translateX(5px);
            box-shadow: 0 0 20px rgba(204, 0, 0, 0.4);
        }

        .resource-link-icon {
            font-size: 2.5em;
            min-width: 50px;
            text-align: center;
        }

        @media (min-width: 2560px) {
            .resource-link-icon {
                font-size: 3em;
                min-width: 60px;
            }
        }

        .resource-link-content {
            flex: 1;
        }

        .resource-link-title {
            color: #ffffff;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        @media (min-width: 2560px) {
            .resource-link-title {
                font-size: 1.3em;
            }
        }

        .resource-link-desc {
            color: #cccccc;
            font-size: 0.95em;
        }

        @media (min-width: 2560px) {
            .resource-link-desc {
                font-size: 1.05em;
            }
        }

        .hardware-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .hardware-item {
            background: rgba(40, 40, 40, 0.6);
            padding: 12px 15px;
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 0.95em;
            border-left: 3px solid rgba(204, 0, 0, 0.5);
            transition: all 0.2s ease;
        }

        @media (min-width: 2560px) {
            .hardware-item {
                padding: 14px 18px;
                font-size: 1.05em;
            }
        }

        .hardware-item:hover {
            background: rgba(204, 0, 0, 0.2);
            border-left-color: #CC0000;
            transform: translateX(3px);
        }

        .rules-section {
            margin-top: 50px;
            background: rgba(30, 30, 30, 0.8);
            border-radius: 12px;
            padding: 40px;
            border: 2px solid rgba(204, 0, 0, 0.4);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .rules-title {
            color: #CC0000;
            font-size: 2.5em;
            margin-bottom: 35px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(204, 0, 0, 0.6);
        }

        @media (min-width: 2560px) {
            .rules-section {
                padding: 50px;
                margin-top: 60px;
            }

            .rules-title {
                font-size: 3em;
            }
        }

        .rules-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 40px;
        }

        .rule-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            background: rgba(20, 20, 20, 0.7);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #CC0000;
            transition: all 0.3s ease;
        }

        @media (min-width: 2560px) {
            .rule-item {
                padding: 25px;
                gap: 20px;
            }
        }

        .rule-item:hover {
            background: rgba(204, 0, 0, 0.15);
            transform: translateX(5px);
        }

        .rule-icon {
            font-size: 2em;
            min-width: 40px;
            text-align: center;
        }

        @media (min-width: 2560px) {
            .rule-icon {
                font-size: 2.3em;
                min-width: 50px;
            }
        }

        .rule-text {
            color: #e0e0e0;
            line-height: 1.6;
            font-size: 1.05em;
        }

        @media (min-width: 2560px) {
            .rule-text {
                font-size: 1.15em;
            }
        }

        .rule-text strong {
            color: #ffffff;
            font-weight: bold;
        }

        .app-store-link {
            color: #ff3333;
            font-weight: bold;
            text-decoration: underline;
            transition: all 0.3s ease;
        }

        .app-store-link:hover {
            color: #ffffff;
            text-shadow: 0 0 10px rgba(204, 0, 0, 0.8);
            text-decoration: none;
        }

        .bonus-section {
            background: rgba(204, 0, 0, 0.1);
            border: 2px solid rgba(204, 0, 0, 0.5);
            border-radius: 10px;
            padding: 30px;
        }

        @media (min-width: 2560px) {
            .bonus-section {
                padding: 35px;
            }
        }

        .bonus-title {
            color: #ff3333;
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 25px;
            text-shadow: 0 0 10px rgba(204, 0, 0, 0.5);
        }

        @media (min-width: 2560px) {
            .bonus-title {
                font-size: 1.7em;
            }
        }

        .bonus-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        @media (min-width: 2560px) {
            .bonus-items {
                gap: 25px;
            }
        }

        .bonus-item {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(20, 20, 20, 0.8);
            padding: 18px 25px;
            border-radius: 8px;
            border: 1px solid rgba(204, 0, 0, 0.4);
            transition: all 0.3s ease;
        }

        @media (min-width: 2560px) {
            .bonus-item {
                padding: 22px 30px;
            }
        }

        .bonus-item:hover {
            background: rgba(204, 0, 0, 0.25);
            border-color: #CC0000;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(204, 0, 0, 0.4);
        }

        .bonus-icon {
            font-size: 1.8em;
        }

        @media (min-width: 2560px) {
            .bonus-icon {
                font-size: 2em;
            }
        }

        .bonus-text {
            color: #ffffff;
            font-weight: bold;
            font-size: 1.1em;
        }

        @media (min-width: 2560px) {
            .bonus-text {
                font-size: 1.2em;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üéØ BeagleBadge Hackathon 2026 üéØ</h1>
        <div class="subtitle">Race for the ultimate badge hacker!</div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            Fetching repository statistics from GitHub...
        </div>

        <div id="error" style="display: none;"></div>

        <div id="content" style="display: none;">
            <div class="top-sections-container">
                <div class="race-section">
                    <div class="race-title">üèÅ The Race is ON! üèÅ</div>
                    <div class="race-tabs">
                        <button class="race-tab active" onclick="switchRace('stars')">‚≠ê Stars Race</button>
                        <button class="race-tab" onclick="switchRace('code')">üìù Code Race</button>
                    </div>
                    <div class="race-track" id="race-track"></div>
                </div>

                <div class="special-prize-section">
                    <div class="special-prize-title">üèÜ Special Prize Category üèÜ</div>
                    <div class="special-prize-subtitle">Core Repository Contributions</div>

                    <div class="special-prize-grid">
                        <div class="special-prize-card">
                            <div class="special-prize-card-header">
                                <span class="special-prize-icon">üì¶</span>
                                <div>
                                    <div class="special-prize-card-title">Badge App Store</div>
                                    <a href="https://github.com/Grippy98/badge-app-store" target="_blank"
                                        class="special-prize-link">View Repository ‚Üí</a>
                                </div>
                            </div>
                            <div class="special-prize-stats">
                                <div class="special-prize-stat">
                                    <div class="special-prize-stat-label">Unique PR Contributors</div>
                                    <div class="special-prize-stat-value" id="app-store-contributors">
                                        <div class="spinner-small"></div>
                                    </div>
                                </div>
                                <div class="special-prize-stat">
                                    <div class="special-prize-stat-label">Total Lines of Code</div>
                                    <div class="special-prize-stat-value" id="app-store-lines">
                                        <div class="spinner-small"></div>
                                    </div>
                                </div>
                                <div class="special-prize-stat">
                                    <div class="special-prize-stat-label">Pull Requests</div>
                                    <div class="special-prize-stat-value" id="app-store-prs">
                                        <div class="spinner-small"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="special-prize-card">
                            <div class="special-prize-card-header">
                                <span class="special-prize-icon">üõ†Ô∏è</span>
                                <div>
                                    <div class="special-prize-card-title">Badge Development</div>
                                    <a href="https://github.com/Grippy98/badge-slop/tree/linux-wip" target="_blank"
                                        class="special-prize-link">View Repository ‚Üí</a>
                                </div>
                            </div>
                            <div class="special-prize-stats">
                                <div class="special-prize-stat">
                                    <div class="special-prize-stat-label">Unique PR Contributors</div>
                                    <div class="special-prize-stat-value" id="badge-slop-contributors">
                                        <div class="spinner-small"></div>
                                    </div>
                                </div>
                                <div class="special-prize-stat">
                                    <div class="special-prize-stat-label">Total Lines of Code</div>
                                    <div class="special-prize-stat-value" id="badge-slop-lines">
                                        <div class="spinner-small"></div>
                                    </div>
                                </div>
                                <div class="special-prize-stat">
                                    <div class="special-prize-stat-label">Pull Requests</div>
                                    <div class="special-prize-stat-value" id="badge-slop-prs">
                                        <div class="spinner-small"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="special-prize-contributors" id="special-prize-contributors-list">
                        <div class="special-prize-contributors-title">üåü All Contributors üåü</div>
                        <div id="all-contributors-grid" class="all-contributors-grid">
                            <div class="spinner-small"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tree" id="tree"></div>

            <div class="leaderboard">
                <div class="leaderboard-card">
                    <div class="leaderboard-title">‚≠ê Most Stars</div>
                    <div id="stars-leaderboard"></div>
                </div>
                <div class="leaderboard-card">
                    <div class="leaderboard-title">üìù Most Code</div>
                    <div id="code-leaderboard"></div>
                </div>
                <div class="leaderboard-card">
                    <div class="leaderboard-title">üë• Most Contributors</div>
                    <div id="contributors-leaderboard"></div>
                </div>
            </div>

            <div class="resources-section">
                <div class="resources-title">üîó Resources & Hardware üîó</div>

                <div class="resources-grid">
                    <div class="resources-card">
                        <div class="resources-card-title">üìö Important Links</div>
                        <div class="resource-links">
                            <a href="https://github.com/Grippy98/badge-app-store" target="_blank" class="resource-link">
                                <span class="resource-link-icon">üì¶</span>
                                <div class="resource-link-content">
                                    <div class="resource-link-title">Badge App Store</div>
                                    <div class="resource-link-desc">Submit your apps here!</div>
                                </div>
                            </a>
                            <a href="https://github.com/Grippy98/badge-slop/tree/linux-wip" target="_blank"
                                class="resource-link">
                                <span class="resource-link-icon">üõ†Ô∏è</span>
                                <div class="resource-link-content">
                                    <div class="resource-link-title">Badge Development (linux-wip)</div>
                                    <div class="resource-link-desc">Tools and examples</div>
                                </div>
                            </a>
                        </div>
                    </div>

                    <div class="resources-card">
                        <div class="resources-card-title">üîß Hardware Features</div>
                        <div class="hardware-list">
                            <div class="hardware-item">üîå USB-to-serial (Type-C connector)</div>
                            <div class="hardware-item">üñ•Ô∏è USB host (A connector)</div>
                            <div class="hardware-item">üî¥ Reset button</div>
                            <div class="hardware-item">üí° Light sensor (via ADC)</div>
                            <div class="hardware-item">üåà Tri-color LED (via PWM)</div>
                            <div class="hardware-item">7Ô∏è‚É£ 2-digit 7-segment display (via SPI)</div>
                            <div class="hardware-item">üìê Accelerometer (via I2C)</div>
                            <div class="hardware-item">üå°Ô∏è Temperature Sensor</div>
                            <div class="hardware-item">üíæ EEPROM (write-protected) (via I2C)</div>
                            <div class="hardware-item">üîó mikroBus header (SPI/PWM/I2C/etc)</div>
                            <div class="hardware-item">üîä Piezo Buzzer</div>
                            <div class="hardware-item">üîã Battery Fuel Gauge</div>
                            <div class="hardware-item">‚ö° 2x QWIIC I2C Ports</div>
                            <div class="hardware-item">üìç 1x Grove UART for GPS</div>
                            <div class="hardware-item">üéõÔ∏è ~25 GPIOs</div>
                            <div class="hardware-item">üîç SOICBite TestAutomation/JTAG Header</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="rules-section">
                <div class="rules-title">üìã Competition Rules üìã</div>

                <div class="rules-content">
                    <div class="rule-item">
                        <span class="rule-icon">üñ•Ô∏è</span>
                        <div class="rule-text">
                            <strong>Hardware Constraints:</strong> The app must be able to run within the constraints of
                            the AM62L BeagleBadge ‚Äì 256MB LPDDR4, 2xA53 Cores, E-Ink
                        </div>
                    </div>

                    <div class="rule-item">
                        <span class="rule-icon">üîå</span>
                        <div class="rule-text">
                            <strong>Accessories:</strong> External sensors, USB devices, etc are
                            <strong>ALLOWED</strong> if they can reasonably be connected.
                        </div>
                    </div>

                    <div class="rule-item">
                        <span class="rule-icon">üì¶</span>
                        <div class="rule-text">
                            <strong>Submission:</strong> Applications must be submitted to the <a
                                href="https://github.com/Grippy98/badge-app-store" target="_blank"
                                class="app-store-link">Badge App Store Repo</a> to be counted.
                        </div>
                    </div>

                    <div class="rule-item">
                        <span class="rule-icon">üêß</span>
                        <div class="rule-text">
                            <strong>Full Debian Access:</strong> Applications are allowed to take advantage of the full
                            Debian Linux distro features running in the background ‚Äì including APT package manager etc
                            and do not need to be strictly Micropython/LVGL (you can make system calls outside of it)
                        </div>
                    </div>

                    <div class="rule-item">
                        <span class="rule-icon">üöÄ</span>
                        <div class="rule-text">
                            <strong>Launcher Freedom:</strong> Applications can break free of the "Launcher" entirely
                            but must exit cleanly and re-enable the badge launcher upon exiting.
                        </div>
                    </div>

                    <div class="rule-item">
                        <span class="rule-icon">‚úÖ</span>
                        <div class="rule-text">
                            <strong>Content Policy:</strong> Everything must be sufficiently age appropriate and
                            respectful.
                        </div>
                    </div>
                </div>

                <div class="bonus-section">
                    <div class="bonus-title">‚≠ê Bonus Categories (+10% star multiplier) ‚≠ê</div>
                    <div class="bonus-items">
                        <div class="bonus-item">
                            <span class="bonus-icon">ü§ñ</span>
                            <span class="bonus-text">Some form of AI/ML on AM62L</span>
                        </div>
                        <div class="bonus-item">
                            <span class="bonus-icon">üîã</span>
                            <span class="bonus-text">Low Power</span>
                        </div>
                        <div class="bonus-item">
                            <span class="bonus-icon">üí°</span>
                            <span class="bonus-text">Judge's discretion for Innovation</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let apps = [];

        function cleanRepoUrl(url) {
            if (!url) return '';
            // Handle https://github.com/user/repo.git or just user/repo
            let clean = url.replace('https://github.com/', '').replace('.git', '');
            if (clean.endsWith('/')) clean = clean.slice(0, -1);
            return clean;
        }

        const CACHE_KEY = 'badge_stats_cache';
        const SPECIAL_CACHE_KEY = 'badge_special_stats_cache';
        const CACHE_TTL = 60 * 60 * 1000; // 1 hour

        function getCachedData(key) {
            const cached = localStorage.getItem(key);
            if (!cached) return null;
            const { timestamp, data } = JSON.parse(cached);
            if (Date.now() - timestamp > CACHE_TTL) return null;
            return data;
        }

        function setCachedData(key, data) {
            localStorage.setItem(key, JSON.stringify({
                timestamp: Date.now(),
                data: data
            }));
        }

        async function fetchBatchStats(repos) {
            // GitHub Search API allows querying up to 1000 items, but URL length limits 
            // query qualifiers. We'll batch in groups of 10.
            const statsMap = {};
            const batchSize = 10;

            for (let i = 0; i < repos.length; i += batchSize) {
                const batch = repos.slice(i, i + batchSize);
                const query = batch.map(r => `repo:${r}`).join('+');
                try {
                    const response = await fetch(`https://api.github.com/search/repositories?q=${query}`);
                    if (!response.ok) continue;
                    const data = await response.json();
                    data.items.forEach(repo => {
                        statsMap[repo.full_name.toLowerCase()] = {
                            stars: repo.stargazers_count,
                            linesOfCode: Math.round((repo.size * 1024) / 50), // KB to estimated lines
                            url: repo.html_url,
                            description: repo.description,
                            language: repo.language,
                            latestCommitDate: repo.pushed_at, // Close enough proxy for latest activity
                            owner: {
                                username: repo.owner.login,
                                avatar: repo.owner.avatar_url,
                                url: repo.owner.html_url
                            }
                        };
                    });
                } catch (e) {
                    console.error('Batch fetch error:', e);
                }
            }
            return statsMap;
        }

        async function fetchRepoDetails(repo, basicStats) {
            // These calls are still per-repo but we can make them conditional or optional
            // For now, let's keep them limited.
            try {
                // Fetch contributors only if we really need the list
                const contributorsResponse = await fetch(`https://api.github.com/repos/${repo}/contributors`);
                const contributorsData = contributorsResponse.ok ? await contributorsResponse.json() : [];

                return {
                    ...basicStats,
                    contributors: Array.isArray(contributorsData) ? contributorsData.length : 0,
                    contributorsList: contributorsData.slice(0, 3).map(c => ({
                        username: c.login,
                        avatar: c.avatar_url,
                        contributions: c.contributions,
                        url: c.html_url
                    })),
                    totalCommits: contributorsData.reduce((sum, c) => sum + (c.contributions || 0), 0)
                };
            } catch (error) {
                return {
                    ...basicStats,
                    contributors: 0,
                    contributorsList: [],
                    totalCommits: 0
                };
            }
        }

        function generateTreeBranch(index, total, isLast) {
            if (index === 0) return '‚îå‚îÄ';
            if (isLast) return '‚îî‚îÄ';
            return '‚îú‚îÄ';
        }

        function renderTree(appsWithStats) {
            const tree = document.getElementById('tree');
            let html = '<div class="tree-root">üì¶ badge-app-store/</div>';

            // Sort by latest commit date (most recent first)
            const filteredAndSorted = [...appsWithStats]
                .sort((a, b) => {
                    const dateA = a.stats.latestCommitDate ? new Date(a.stats.latestCommitDate) : new Date(0);
                    const dateB = b.stats.latestCommitDate ? new Date(b.stats.latestCommitDate) : new Date(0);
                    return dateB - dateA;
                });

            // Log for debugging if needed
            console.log('Tree sorted by recency:', filteredAndSorted.map(a => `${a.name}: ${a.stats.latestCommitDate}`));

            filteredAndSorted.forEach((app, index) => {
                const isLast = index === filteredAndSorted.length - 1;
                const branch = generateTreeBranch(index, filteredAndSorted.length, isLast);

                const contributorsHtml = app.stats.contributorsList && app.stats.contributorsList.length > 0
                    ? `<div class="contributors-list">
                        ${app.stats.contributorsList.map(c => `
                            <div class="contributor" title="${c.username} (${c.contributions} contributions)">
                                <img src="${c.avatar}" alt="${c.username}" class="contributor-avatar">
                                <span class="contributor-name">@${c.username}</span>
                            </div>
                        `).join('')}
                       </div>`
                    : '';

                // Find original index for showAppDetails
                const originalIndex = appsWithStats.findIndex(a => a.name === app.name);

                // Format latest commit date
                const commitDate = app.stats.latestCommitDate
                    ? new Date(app.stats.latestCommitDate).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    })
                    : 'N/A';

                html += `
                    <div class="tree-item" onclick="showAppDetails(${originalIndex})" style="cursor: pointer;">
                        <div class="tree-content">
                            <span class="tree-branch">${branch}</span>
                            <span class="app-name">${app.name}</span>
                            <span class="stat-box stat-stars">‚≠ê ${app.stats.stars}</span>
                            <span class="stat-box stat-code">üìù ${app.stats.linesOfCode.toLocaleString()} lines</span>
                            <span class="stat-box stat-commits">üíæ ${app.stats.totalCommits} commits</span>
                            <span class="stat-box stat-date">üìÖ ${commitDate}</span>
                            <span class="stat-box stat-contributors">üë• ${app.stats.contributors}</span>
                        </div>
                        ${contributorsHtml}
                    </div>
                `;
            });

            tree.innerHTML = html;
        }

        function renderLeaderboards(appsWithStats) {
            // Most Stars - only show apps with stars
            const appsWithStars = appsWithStats.filter(app => app.stats.stars > 0);
            const byStars = [...appsWithStars].sort((a, b) => b.stats.stars - a.stats.stars);
            const starsHtml = byStars.slice(0, 5).map((app, i) => `
                <div class="leaderboard-item">
                    <span class="rank">#${i + 1}</span>
                    <span class="item-name">${app.name}</span>
                    <span class="item-value">${app.stats.stars} ‚≠ê</span>
                </div>
            `).join('');
            document.getElementById('stars-leaderboard').innerHTML = starsHtml;

            // Most Code - show all repos with code
            const appsWithCode = appsWithStats.filter(app => app.stats.linesOfCode > 0);
            const byCode = [...appsWithCode].sort((a, b) => b.stats.linesOfCode - a.stats.linesOfCode);
            const codeHtml = byCode.map((app, i) => `
                <div class="leaderboard-item">
                    <span class="rank">#${i + 1}</span>
                    <span class="item-name">${app.name}</span>
                    <span class="item-value">${app.stats.linesOfCode.toLocaleString()}</span>
                </div>
            `).join('');
            document.getElementById('code-leaderboard').innerHTML = codeHtml;

            // Most Contributors - show apps with code
            const byContributors = [...appsWithCode].sort((a, b) => b.stats.contributors - a.stats.contributors);
            const contributorsHtml = byContributors.slice(0, 5).map((app, i) => `
                <div class="leaderboard-item">
                    <span class="rank">#${i + 1}</span>
                    <span class="item-name">${app.name}</span>
                    <span class="item-value">${app.stats.contributors} üë•</span>
                </div>
            `).join('');
            document.getElementById('contributors-leaderboard').innerHTML = contributorsHtml;
        }

        let globalAppsData = [];
        let currentRaceType = 'stars';

        function getFilteredApps(appsWithStats) {
            // Filter logic: Only show top 2 most starred apps for Grippy98
            const grippy98Apps = appsWithStats.filter(app => app.stats.owner?.username === 'Grippy98');
            const otherApps = appsWithStats.filter(app => app.stats.owner?.username !== 'Grippy98');
            const topGrippy98 = [...grippy98Apps]
                .sort((a, b) => b.stats.stars - a.stats.stars)
                .slice(0, 2);

            return [...otherApps, ...topGrippy98];
        }

        function renderRace(appsWithStats, type) {
            const track = document.getElementById('race-track');
            let sortedApps;
            let emoji;
            let unit;

            switch (type) {
                case 'stars':
                    sortedApps = [...appsWithStats]
                        .filter(app => app.stats.stars > 0)
                        .sort((a, b) => b.stats.stars - a.stats.stars);
                    emoji = '‚≠ê';
                    unit = '';
                    break;
                case 'code':
                    sortedApps = [...appsWithStats]
                        .filter(app => app.stats.linesOfCode > 0)
                        .sort((a, b) => b.stats.linesOfCode - a.stats.linesOfCode);
                    emoji = 'üìù';
                    unit = ' lines';
                    break;
            }

            if (sortedApps.length === 0) {
                track.innerHTML = '<div style="text-align: center; color: #5a7d9a; padding: 20px;">No data available</div>';
                return;
            }

            // Use logarithmic scaling for better visualization
            const values = sortedApps.map(app =>
                type === 'stars' ? app.stats.stars : app.stats.linesOfCode
            );
            const maxValue = Math.max(...values);
            const minValue = Math.min(...values.filter(v => v > 0));

            // Use log scale with a minimum bar width of 20%
            const logMax = Math.log10(maxValue + 1);
            const logMin = Math.log10(minValue + 1);

            const html = sortedApps.map((app, index) => {
                const value = type === 'stars' ? app.stats.stars : app.stats.linesOfCode;

                // Logarithmic scale ensures smaller values are still visible
                const logValue = Math.log10(value + 1);
                const normalizedLog = (logValue - logMin) / (logMax - logMin);
                // Scale from 20% to 100% so all bars are visible
                const percentage = 20 + (normalizedLog * 80);

                const positionClass = index === 0 ? 'first' : index === 1 ? 'second' : index === 2 ? 'third' : 'other';
                const barClass = index === 0 ? 'first' : index === 1 ? 'second' : index === 2 ? 'third' : '';

                const mainContributor = app.stats.contributorsList && app.stats.contributorsList[0];
                const avatar = mainContributor ? mainContributor.avatar : app.stats.owner?.avatar || '';
                const username = mainContributor ? mainContributor.username : app.stats.owner?.username || 'Unknown';
                const repoUrl = app.stats.url || `https://github.com/${app.repo}`;

                return `
                    <a href="${repoUrl}" target="_blank" style="text-decoration: none; display: block; cursor: pointer;">
                        <div class="race-row">
                            <div class="race-position ${positionClass}">${index + 1}</div>
                            <div class="racer-info">
                                <img src="${avatar}" alt="${username}" class="racer-avatar" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2240%22><rect width=%2240%22 height=%2240%22 fill=%22%23CC0000%22/><text x=%2250%%22 y=%2250%%22 font-size=%2220%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22white%22>?</text></svg>'">
                                <div>
                                    <div class="racer-name">${app.name}</div>
                                    <div style="font-size: 0.8em; color: #999999;">@${username}</div>
                                </div>
                            </div>
                            <div class="race-bar-container">
                                <div class="race-bar ${barClass}" style="width: ${percentage}%">
                                    <span class="race-value">${emoji} ${value.toLocaleString()}${unit}</span>
                                </div>
                            </div>
                        </div>
                    </a>
                `;
            }).join('');

            track.innerHTML = html;

            // Trigger animation
            setTimeout(() => {
                document.querySelectorAll('.race-bar').forEach((bar, i) => {
                    const targetWidth = bar.style.width;
                    bar.style.width = '0%';
                    setTimeout(() => {
                        bar.style.width = targetWidth;
                    }, 50);
                });
            }, 100);
        }

        function switchRace(type) {
            currentRaceType = type;

            // Update active tab
            document.querySelectorAll('.race-tab').forEach(tab => tab.classList.remove('active'));
            // Use event if available, or find button by text
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                const tabs = document.querySelectorAll('.race-tab');
                tabs.forEach(tab => {
                    if (tab.textContent.toLowerCase().includes(type)) {
                        tab.classList.add('active');
                    }
                });
            }

            // Render race
            if (globalAppsData.length > 0) {
                const filteredApps = getFilteredApps(globalAppsData);
                renderRace(filteredApps, type);
            }
        }

        function showAppDetails(index) {
            const app = globalAppsData[index];
            const contributors = app.stats.contributorsList || [];

            const contributorsList = contributors.map(c => `
                <div class="contributor" style="margin: 5px;">
                    <img src="${c.avatar}" alt="${c.username}" class="contributor-avatar">
                    <span class="contributor-name">@${c.username}</span>
                    <span style="color: #999999; margin-left: 5px;">(${c.contributions} commits)</span>
                </div>
            `).join('');

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;

            modal.innerHTML = `
                <div style="background: #1a1a1a; padding: 40px; border-radius: 12px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; border: 3px solid #CC0000; box-shadow: 0 0 30px rgba(204, 0, 0, 0.5);">
                    <h2 style="color: #CC0000; margin-bottom: 20px; text-shadow: 0 0 10px rgba(204, 0, 0, 0.5);">${app.name}</h2>
                    <p style="color: #cccccc; margin-bottom: 20px; line-height: 1.6;">${app.stats.description || 'No description available'}</p>

                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px;">
                        <div style="background: rgba(40, 40, 40, 0.8); padding: 15px; border-radius: 8px; border: 1px solid rgba(204, 0, 0, 0.3);">
                            <div style="color: #808080; font-size: 0.9em;">Language</div>
                            <div style="color: #ffffff; font-weight: bold; font-size: 1.2em;">${app.stats.language || 'Unknown'}</div>
                        </div>
                        <div style="background: rgba(40, 40, 40, 0.8); padding: 15px; border-radius: 8px; border: 1px solid rgba(204, 0, 0, 0.3);">
                            <div style="color: #808080; font-size: 0.9em;">Stars</div>
                            <div style="color: #ff3333; font-weight: bold; font-size: 1.2em;">‚≠ê ${app.stats.stars}</div>
                        </div>
                        <div style="background: rgba(40, 40, 40, 0.8); padding: 15px; border-radius: 8px; border: 1px solid rgba(204, 0, 0, 0.3);">
                            <div style="color: #808080; font-size: 0.9em;">Lines of Code</div>
                            <div style="color: #ffffff; font-weight: bold; font-size: 1.2em;">üìù ${app.stats.linesOfCode.toLocaleString()}</div>
                        </div>
                        <div style="background: rgba(40, 40, 40, 0.8); padding: 15px; border-radius: 8px; border: 1px solid rgba(204, 0, 0, 0.3);">
                            <div style="color: #808080; font-size: 0.9em;">Total Commits</div>
                            <div style="color: #e0e0e0; font-weight: bold; font-size: 1.2em;">üíæ ${app.stats.totalCommits}</div>
                        </div>
                        <div style="background: rgba(40, 40, 40, 0.8); padding: 15px; border-radius: 8px; border: 1px solid rgba(204, 0, 0, 0.3);">
                            <div style="color: #808080; font-size: 0.9em;">Latest Commit</div>
                            <div style="color: #cccccc; font-weight: bold; font-size: 1.2em;">üìÖ ${app.stats.latestCommitDate ? new Date(app.stats.latestCommitDate).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) : 'N/A'}</div>
                        </div>
                        <div style="background: rgba(40, 40, 40, 0.8); padding: 15px; border-radius: 8px; border: 1px solid rgba(204, 0, 0, 0.3);">
                            <div style="color: #808080; font-size: 0.9em;">Contributors</div>
                            <div style="color: #cccccc; font-weight: bold; font-size: 1.2em;">üë• ${app.stats.contributors}</div>
                        </div>
                    </div>

                    ${contributors.length > 0 ? `
                        <div style="margin-bottom: 25px;">
                            <h3 style="color: #ffffff; margin-bottom: 15px;">Top Contributors</h3>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                ${contributorsList}
                            </div>
                        </div>
                    ` : ''}

                    <div style="margin-bottom: 25px;">
                        <h3 style="color: #CC0000; margin-bottom: 10px;">Repository Owner</h3>
                        <div class="contributor">
                            <img src="${app.stats.owner?.avatar || ''}" alt="${app.stats.owner?.username || 'Unknown'}" class="contributor-avatar">
                            <span class="contributor-name">@${app.stats.owner?.username || 'Unknown'}</span>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 25px;">
                        <a href="${app.stats.url}" target="_blank" style="flex: 1; background: #CC0000; color: #ffffff; padding: 12px; border-radius: 8px; text-align: center; text-decoration: none; font-weight: bold; box-shadow: 0 0 10px rgba(204, 0, 0, 0.5);">
                            View on GitHub ‚Üí
                        </a>
                        <button onclick="this.closest('div[style*=fixed]').remove()" style="padding: 12px 20px; background: #666666; color: #ffffff; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            Close
                        </button>
                    </div>
                </div>
            `;

            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };

            document.body.appendChild(modal);
        }

        async function fetchSpecialPrizeStats(repo) {
            try {
                // Fetch pull requests (all states)
                const prsResponse = await fetch(`https://api.github.com/repos/${repo}/pulls?state=all&per_page=100`);
                const prs = prsResponse.ok ? await prsResponse.json() : [];

                // Get unique contributors from PRs
                const uniqueContributors = new Map();
                prs.forEach(pr => {
                    if (pr.user && pr.user.login) {
                        if (uniqueContributors.has(pr.user.login)) {
                            uniqueContributors.get(pr.user.login).prs++;
                        } else {
                            uniqueContributors.set(pr.user.login, {
                                username: pr.user.login,
                                avatar: pr.user.avatar_url,
                                prs: 1
                            });
                        }
                    }
                });

                // Fetch languages to estimate code size
                const languagesResponse = await fetch(`https://api.github.com/repos/${repo}/languages`);
                const languagesData = languagesResponse.ok ? await languagesResponse.json() : {};
                const totalBytes = Object.values(languagesData).reduce((sum, bytes) => sum + bytes, 0);
                const estimatedLines = Math.round(totalBytes / 50);

                return {
                    prCount: prs.length,
                    uniqueContributors: Array.from(uniqueContributors.values()),
                    contributorCount: uniqueContributors.size,
                    linesOfCode: estimatedLines
                };
            } catch (error) {
                console.error(`Error fetching special prize stats for ${repo}:`, error);
                return {
                    prCount: 0,
                    uniqueContributors: [],
                    contributorCount: 0,
                    linesOfCode: 0
                };
            }
        }

        async function loadSpecialPrizeStats() {
            try {
                // Try Cache First
                const cachedSpecial = getCachedData(SPECIAL_CACHE_KEY);
                if (cachedSpecial) {
                    console.log('Using cached special prize stats');
                    renderSpecialPrizeUI(cachedSpecial.appStoreStats, cachedSpecial.badgeSlopStats, cachedSpecial.sortedContributors);
                    return;
                }

                // Fetch stats for both repositories
                const [appStoreStats, badgeSlopStats] = await Promise.all([
                    fetchSpecialPrizeStats('Grippy98/badge-app-store'),
                    fetchSpecialPrizeStats('Grippy98/badge-slop')
                ]);

                // Combine all contributors and sort by PR count
                const allContributors = new Map();

                [...appStoreStats.uniqueContributors, ...badgeSlopStats.uniqueContributors].forEach(contributor => {
                    if (allContributors.has(contributor.username)) {
                        allContributors.get(contributor.username).prs += contributor.prs;
                    } else {
                        allContributors.set(contributor.username, { ...contributor });
                    }
                });

                const sortedContributors = Array.from(allContributors.values())
                    .sort((a, b) => b.prs - a.prs);

                renderSpecialPrizeUI(appStoreStats, badgeSlopStats, sortedContributors);

                // Cache the results
                setCachedData(SPECIAL_CACHE_KEY, {
                    appStoreStats,
                    badgeSlopStats,
                    sortedContributors
                });

            } catch (error) {
                console.error('Error loading special prize stats:', error);
                ['app-store-contributors', 'app-store-lines', 'app-store-prs',
                    'badge-slop-contributors', 'badge-slop-lines', 'badge-slop-prs'].forEach(id => {
                        const el = document.getElementById(id);
                        if (el) el.textContent = 'Error';
                    });
            }
        }

        function renderSpecialPrizeUI(appStoreStats, badgeSlopStats, sortedContributors) {
            // Update App Store stats
            document.getElementById('app-store-contributors').textContent = appStoreStats.contributorCount;
            document.getElementById('app-store-lines').textContent = appStoreStats.linesOfCode.toLocaleString();
            document.getElementById('app-store-prs').textContent = appStoreStats.prCount;

            // Update Badge Slop stats
            document.getElementById('badge-slop-contributors').textContent = badgeSlopStats.contributorCount;
            document.getElementById('badge-slop-lines').textContent = badgeSlopStats.linesOfCode.toLocaleString();
            document.getElementById('badge-slop-prs').textContent = badgeSlopStats.prCount;

            // Render contributors list
            const contributorsGrid = document.getElementById('all-contributors-grid');
            if (sortedContributors.length > 0) {
                contributorsGrid.innerHTML = sortedContributors.map(contributor => `
                    <a href="https://github.com/${contributor.username}" target="_blank" class="special-contributor-card" style="text-decoration: none;">
                        <img src="${contributor.avatar}" alt="${contributor.username}" class="special-contributor-avatar" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2250%22 height=%2250%22><rect width=%2250%22 height=%2250%22 fill=%22%23CC0000%22/><text x=%2250%%22 y=%2250%%22 font-size=%2224%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22white%22>?</text></svg>'">
                        <div class="special-contributor-info">
                            <div class="special-contributor-name">@${contributor.username}</div>
                            <div class="special-contributor-prs">${contributor.prs} PR${contributor.prs !== 1 ? 's' : ''}</div>
                        </div>
                    </a>
                `).join('');
            } else {
                contributorsGrid.innerHTML = '<div style="text-align: center; color: #808080; grid-column: 1/-1;">No contributors yet</div>';
            }
        }

        async function loadAllStats() {
            try {
                // 1. Try Cache First
                const cachedData = getCachedData(CACHE_KEY);
                if (cachedData) {
                    console.log('Using cached repository stats');
                    globalAppsData = cachedData;
                    const filteredApps = getFilteredApps(cachedData);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('content').style.display = 'block';
                    renderTree(cachedData);
                    renderRace(filteredApps, currentRaceType);
                    renderLeaderboards(filteredApps);

                    // Also load special stats (which has its own cache check)
                    loadSpecialPrizeStats();
                    return;
                }

                // 2. Fetch Manifest
                const manifestResponse = await fetch('https://raw.githubusercontent.com/Grippy98/badge-app-store/master/manifest.json');
                if (!manifestResponse.ok) throw new Error('Failed to fetch manifest');
                const manifestData = await manifestResponse.json();

                const repoUrls = manifestData.apps.map(app => cleanRepoUrl(app.repo)).filter(url => url);

                // 3. Batch Fetch Basic Stats (1 request per 10 repos)
                console.log(`Fetching batch stats for ${repoUrls.length} repos...`);
                const batchStats = await fetchBatchStats(repoUrls);

                // 4. Fetch Details (Contributors etc) - this is still per-repo but optional
                // To be safe with rate limits, we'll only do this for the first load
                const appsWithStats = await Promise.all(
                    manifestData.apps.map(async (app) => {
                        const cleanUrl = cleanRepoUrl(app.repo);
                        const basic = batchStats[cleanUrl.toLowerCase()] || {
                            stars: 0, linesOfCode: 0, latestCommitDate: null,
                            owner: { username: 'Unknown', avatar: '', url: '' }
                        };

                        // We still fetch details to get total commits and contributor list
                        // but these are more likely to fail gracefully
                        return {
                            name: app.name,
                            repo: cleanUrl,
                            stats: await fetchRepoDetails(cleanUrl, basic)
                        };
                    })
                );

                globalAppsData = appsWithStats;
                setCachedData(CACHE_KEY, appsWithStats);
                const filteredApps = getFilteredApps(appsWithStats);

                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';

                renderTree(appsWithStats);
                renderRace(filteredApps, currentRaceType);
                renderLeaderboards(filteredApps);

                // Load Special Prize stats
                loadSpecialPrizeStats();

                // Check for errors
                const errors = appsWithStats.filter(app => app.stats.error);
                if (errors.length > 0) {
                    const errorDiv = document.getElementById('error');
                    errorDiv.innerHTML = `
                        <div class="error">
                            ‚ö†Ô∏è Warning: Could not fetch data for some repositories.
                            This might be due to rate limiting or network issues.
                        </div>
                    `;
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                const errorDiv = document.getElementById('error');
                errorDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Error loading statistics: ${error.message}
                        <br><br>
                        This might be due to GitHub API rate limiting. Try again in a few minutes.
                    </div>
                `;
                errorDiv.style.display = 'block';
            }
        }

        // Load stats on page load
        loadAllStats();
    </script>
</body>

</html>